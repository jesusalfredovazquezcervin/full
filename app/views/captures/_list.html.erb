<div class="row">
  <div class="col-lg-12">
    <div class="ibox">
      <div class="ibox-title">
        <h5>Listados de captura <small>Aqui estan todos los registros de captura para el cliente</small></h5>
        <div class="ibox-tools">
          <a class="collapse-link">
            <i class="fa fa-chevron-up"></i>
          </a>
          <a class="fullscreen-link">
            <i class="fa fa-expand"></i>
          </a>
          <a class="close-link">
            <i class="fa fa-times"></i>
          </a>
        </div>
      </div>

      <!-- Listados -->
      <div class="ibox-content">
        <div>
          <ul class="nav nav-tabs">
            <% @cliente.forms.order(:id).each_with_index do |f, index| %>
                <li class="<%= index == 0 ? ("active"):("") %>"><a data-toggle="tab" href="#tab-<%=index+1%>"><%=f.name%></a></li>
            <%end%>
          </ul>
          <div class="tab-content">
            <br>
            <h5>Listados de captura <small>Aqui estan todos los registros de captura para el cliente</small></h5>
            <% @cliente.forms.order(:id).each_with_index do |form, index| %>
                <div id="tab-<%=index+1%>" class="tab-pane <%= index == 0 ? (" active"):("") %>">
                      <%if form.fields.count >0 %>
                          <table class="table table-striped table-bordered table-hover dataTables-example">
                            <thead>
                            <tr>
                              <th>ID</th>
                              <th>Fecha</th>
                              <th>Operador</th>
                              <% form.fields.order(:id).each_with_index do |field, index| %>
                                  <%fld = "field" << (index + 1).to_s%>
                                  <%if field.show_in_list %>
                                      <th> <%=field.name%> </th>
                                  <% end %>
                              <%end%>
                              <th>Acciones</th>
                            </tr>
                            </thead>
                            <tbody>
                            <%  form.informations.order(id: :desc).each do |information| %>
                                <tr>
                                  <td><%= information.id %></td>
                                  <td><%= l information.created_at, format: :large  %></td>
                                  <td><%= Usuario.find_by_id(information.usuario_id).try(:email) %></td>
                                  <% form.fields.order(:id).each_with_index do |field, index| %>
                                      <%fld = "field" << (index + 1).to_s%>
                                      <%case field.data_type%>
                                        <%when "Date"%>
                                          <%valor = information.attributes.each_key.select{|k| k.to_s == fld}.empty? ? nil:(((information.attributes.each_pair.select{|k,v| k.to_s == fld})[0][1]).nil? ? (nil):(((information.attributes.each_pair.select{|k,v| k.to_s == fld})[0][1]).to_date) )  %>
                                        <%when "Datetime"%>
                                          <%valor = information.attributes.each_key.select{|k| k.to_s == fld}.empty? ? nil:(((information.attributes.each_pair.select{|k,v| k.to_s == fld})[0][1]).nil? ? (nil):(((information.attributes.each_pair.select{|k,v| k.to_s == fld})[0][1]).to_date) ) %>
                                        <%when "Boolean"%>
                                          <%valor = information.attributes.each_key.select{|k| k.to_s == fld}.empty? ? nil:!((information.attributes.each_pair.select{|k,v| k.to_s == fld})[0][1]).to_i.zero?%>
                                        <%else%>
                                          <%valor = information.attributes.each_key.select{|k| k.to_s == fld}.empty? ? nil:((information.attributes.each_pair.select{|k,v| k.to_s == fld})[0][1])%>
                                      <%end%>
                                      <%if field.show_in_list %>
                                          <td><%=valor%></td>
                                      <% end %>
                                  <%end%>
                                  <td>
                                    <%= link_to 'V', information,class: "btn btn-primary btn-xs", title:"Ver" %>
                                    <%= link_to "M", edit_information_path(information), class: "btn btn-warning btn-xs", title:"Modificar" %>
                                    <%= link_to 'E', information, method: :delete, class: "btn btn-danger btn-xs", title:"Eliminar" ,data: { confirm: '¿Está seguro?'} %>

                                    <%if form.procedure.deliver? %>
                                        <button type="button" class="btn btn-success btn-xs" data-toggle="modal" data-target="#myModal3" title = "Reenviar email" data-information-id="<%=information.id%>">R</button>
                                    <%end%>
                                  </td>
                                </tr>
                            <%end%>
                            </tbody>
                          </table>
                      <%end%>
                </div>
            <%end%>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>


<div class="modal inmodal" id="myModal3" tabindex="-1" role="dialog" aria-hidden="true">

      <%= render 'captures/form' %>

</div>

<% content_for :javascript do %>

    <script type="text/javascript">


        $(function() {

            $('.footable').footable();
            $('.footable2').footable();

            $('.dataTables-example').dataTable({
                "order": [[ 1, "desc" ]],
                "dom": 'T<"clear">lfrtip',
                "tableTools": {
                    "sSwfPath": "../../assets/dataTables/swf/copy_csv_xls_pdf.swf"
                }
            });

        });

    </script>

<% end %>